---
title: "Abaporu - Master Agent"
sidebar_position: 1  
description: "Agente orquestrador central do sistema multi-agente"
---

# üé® Abaporu - Master Agent

:::info **Status: ‚úÖ Totalmente Funcional**
Implementado em `src/agents/abaporu.py` com capacidades completas de orquestra√ß√£o e auto-reflex√£o.
:::

## üìã Vis√£o Geral

**Abaporu** √© o agente mestre do sistema Cidad√£o.AI, respons√°vel por orquestrar investiga√ß√µes complexas coordenando m√∫ltiplos agentes especializados. Inspirado na obra ic√¥nica de Tarsila do Amaral, representa a "antropofagia" de dados - consumindo informa√ß√µes brutas e transformando em insights acion√°veis.

## üéØ Capacidades Principais

### 1. **Orquestra√ß√£o de Investiga√ß√µes** üéº
- Planejamento estrat√©gico de investiga√ß√µes
- Decomposi√ß√£o de tarefas complexas
- Coordena√ß√£o multi-agente paralela
- S√≠ntese de resultados distribu√≠dos

### 2. **Auto-Reflex√£o e Melhoria** ü™û
```python
REFLECTION_THRESHOLD = 0.8  # Qualidade m√≠nima aceit√°vel
```
- Avalia√ß√£o cont√≠nua de qualidade
- Replanejamento adaptativo
- Aprendizado com resultados
- Otimiza√ß√£o de estrat√©gias

### 3. **Gest√£o de Contexto** üß†
- Manuten√ß√£o de estado da investiga√ß√£o
- Rastreamento de progresso
- Gest√£o de prioridades
- Hist√≥rico de decis√µes

### 4. **Roteamento Inteligente** üõ§Ô∏è
- Sele√ß√£o otimizada de agentes
- Balanceamento de carga
- Fallback strategies
- Paraleliza√ß√£o de tarefas

## üíª Implementa√ß√£o T√©cnica

### Estrutura Principal
```python
class MasterAgent(ReflectiveAgent):
    def __init__(self):
        super().__init__(
            agent_id="abaporu",
            name="Abaporu",
            description="Master orchestrator for multi-agent investigations",
            capabilities=[
                "investigation_planning",
                "multi_agent_coordination",
                "result_synthesis",
                "adaptive_strategy",
                "quality_assurance"
            ]
        )
        self.reflection_threshold = 0.8
        self.max_reflection_attempts = 3
```

### Processo de Investiga√ß√£o
```python
from src.agents.abaporu import MasterAgent, InvestigationPlan

# Inicializar o mestre
abaporu = MasterAgent()

# Criar plano de investiga√ß√£o
plan = InvestigationPlan(
    investigation_id="INV-2024-HEALTH-001",
    title="An√°lise de Contratos do Minist√©rio da Sa√∫de",
    scope={
        "target": "health_ministry_contracts",
        "period": "2024",
        "focus": ["overpricing", "vendor_concentration", "temporal_patterns"]
    },
    priority="high"
)

# Executar investiga√ß√£o
result = await abaporu.coordinate_investigation(plan)

# Estrutura do resultado
{
    "investigation_id": "INV-2024-HEALTH-001",
    "status": "completed",
    "quality_score": 0.92,
    "phases_completed": 4,
    "agents_involved": ["zumbi", "anita", "tiradentes", "nana"],
    "findings": {
        "critical_issues": 3,
        "anomalies_detected": 15,
        "patterns_identified": 7,
        "recommendations": 12
    },
    "synthesis": {
        "executive_summary": "...",
        "key_findings": [...],
        "risk_assessment": "HIGH",
        "next_steps": [...]
    },
    "reflection_iterations": 1,
    "total_time": "127.3s"
}
```

## üîÑ Fluxo de Orquestra√ß√£o

### Diagrama de Processo
```mermaid
graph TD
    A[Recebe Solicita√ß√£o] --> B{An√°lise de Escopo}
    B --> C[Cria Plano de Investiga√ß√£o]
    C --> D[Seleciona Agentes]
    D --> E[Distribui Tarefas]
    
    E --> F1[Zumbi: Detecta Anomalias]
    E --> F2[Anita: Analisa Padr√µes]
    E --> F3[Nan√£: Busca Hist√≥rico]
    
    F1 --> G[Coleta Resultados]
    F2 --> G
    F3 --> G
    
    G --> H{Avalia Qualidade}
    H -->|< 0.8| I[Reflex√£o e Replanejamento]
    I --> D
    H -->|>= 0.8| J[S√≠ntese Final]
    J --> K[Gera Relat√≥rio via Tiradentes]
    K --> L[Retorna Resultado]
```

### Estrat√©gias de Coordena√ß√£o

#### 1. **Investiga√ß√£o Paralela**
```python
async def parallel_investigation(self, tasks):
    """Executa tarefas em paralelo para efici√™ncia"""
    agent_tasks = []
    
    for task in tasks:
        agent = self.select_best_agent(task)
        agent_tasks.append(
            self.delegate_to_agent(agent, task)
        )
    
    results = await asyncio.gather(*agent_tasks)
    return self.merge_results(results)
```

#### 2. **Investiga√ß√£o em Pipeline**
```python
async def pipeline_investigation(self, stages):
    """Executa em sequ√™ncia quando h√° depend√™ncias"""
    result = None
    
    for stage in stages:
        agent = self.get_agent(stage.agent_id)
        result = await agent.process(
            self.prepare_message(stage, result)
        )
        
        if result.quality < self.reflection_threshold:
            result = await self.reflect_and_improve(stage, result)
    
    return result
```

## üìä M√©tricas e Performance

### KPIs Operacionais
| M√©trica | Valor | Meta | Status |
|---------|-------|------|--------|
| Taxa de Sucesso | 94% | >90% | ‚úÖ |
| Tempo M√©dio (investiga√ß√£o) | 98s | <120s | ‚úÖ |
| Reflex√µes Necess√°rias | 12% | <15% | ‚úÖ |
| Qualidade M√©dia | 0.91 | >0.85 | ‚úÖ |

### Estat√≠sticas de Uso
```python
# Distribui√ß√£o de agentes por investiga√ß√£o
{
    "zumbi": 98%,      # Quase sempre usado
    "anita": 85%,      # An√°lise frequente
    "tiradentes": 95%, # Relat√≥rios sempre
    "nana": 78%,       # Contexto hist√≥rico
    "machado": 45%,    # Quando h√° documentos
    "dandara": 32%,    # Quest√µes sociais
    "senna": 89%,      # Roteamento comum
}
```

## üß† Sistema de Reflex√£o

### Processo de Auto-Avalia√ß√£o
```python
async def reflect_on_quality(self, result):
    """Sistema de reflex√£o para melhoria cont√≠nua"""
    
    quality_metrics = {
        "completeness": self.assess_completeness(result),
        "accuracy": self.assess_accuracy(result),
        "relevance": self.assess_relevance(result),
        "actionability": self.assess_actionability(result)
    }
    
    overall_quality = sum(quality_metrics.values()) / len(quality_metrics)
    
    if overall_quality < self.reflection_threshold:
        reflection = {
            "current_quality": overall_quality,
            "gaps": self.identify_gaps(quality_metrics),
            "improvement_plan": self.create_improvement_plan(quality_metrics),
            "additional_agents": self.suggest_additional_agents(result)
        }
        
        return await self.execute_improvement_plan(reflection)
    
    return result
```

### Gatilhos de Reflex√£o
1. **Qualidade < 0.8**: Reflex√£o autom√°tica
2. **Anomalias n√£o explicadas**: Investiga√ß√£o adicional
3. **Conflitos entre agentes**: Reconcilia√ß√£o
4. **Dados insuficientes**: Expans√£o de escopo

## üîß Configura√ß√£o e Customiza√ß√£o

### Par√¢metros de Configura√ß√£o
```python
# config/abaporu.yaml
abaporu:
  reflection_threshold: 0.8
  max_reflection_attempts: 3
  parallel_agent_limit: 5
  timeout_per_agent: 60s
  cache_ttl: 3600s
  
  strategies:
    default: "balanced"
    high_priority: "aggressive"
    exploratory: "thorough"
    
  agent_weights:
    zumbi: 1.0
    anita: 0.9
    tiradentes: 1.0
    nana: 0.7
```

### Personaliza√ß√£o por Dom√≠nio
```python
# Configura√ß√µes espec√≠ficas por tipo de investiga√ß√£o
INVESTIGATION_PROFILES = {
    "contracts": {
        "primary_agents": ["zumbi", "anita"],
        "focus": ["pricing", "vendors", "patterns"],
        "depth": "comprehensive"
    },
    "policies": {
        "primary_agents": ["bonifacio", "machado"],
        "focus": ["effectiveness", "compliance"],
        "depth": "analytical"
    },
    "social": {
        "primary_agents": ["dandara", "anita"],
        "focus": ["equity", "inclusion", "impact"],
        "depth": "detailed"
    }
}
```

## üß™ Testes e Valida√ß√£o

### Suite de Testes
```bash
# Testes unit√°rios
pytest tests/unit/test_agents/test_abaporu.py -v

# Testes de integra√ß√£o
pytest tests/integration/test_multi_agent_coordination.py

# Testes de stress
pytest tests/performance/test_abaporu_load.py

# Cobertura completa
pytest tests/ -k abaporu --cov=src.agents.abaporu
```

### Cen√°rios de Teste
1. ‚úÖ Orquestra√ß√£o simples (2 agentes)
2. ‚úÖ Orquestra√ß√£o complexa (5+ agentes)
3. ‚úÖ Reflex√£o e melhoria
4. ‚úÖ Tratamento de falhas
5. ‚úÖ Timeout e recupera√ß√£o
6. ‚úÖ Cache e performance

## üöÄ Recursos Avan√ßados

### 1. **Aprendizado Adaptativo**
```python
# Sistema aprende com investiga√ß√µes passadas
self.learning_system.update(
    investigation_id=result.id,
    strategies_used=plan.strategies,
    outcome_quality=result.quality,
    time_taken=result.duration
)
```

### 2. **Previs√£o de Complexidade**
```python
# Estima recursos necess√°rios
complexity_estimate = self.estimate_complexity(investigation_scope)
{
    "estimated_time": "120-180s",
    "agents_needed": ["zumbi", "anita", "tiradentes"],
    "reflection_probability": 0.15,
    "confidence": 0.88
}
```

### 3. **Modo Explorat√≥rio**
```python
# Para investiga√ß√µes sem escopo definido
exploration_mode = {
    "start_broad": True,
    "progressive_refinement": True,
    "discover_patterns": True,
    "no_assumptions": True
}
```

## üìö Melhores Pr√°ticas

### Para Desenvolvedores
1. **Sempre defina timeouts** para evitar travamentos
2. **Use cache** para investiga√ß√µes repetitivas
3. **Configure thresholds** baseados no dom√≠nio
4. **Monitore m√©tricas** de reflex√£o

### Para Usu√°rios
1. **Seja espec√≠fico** no escopo da investiga√ß√£o
2. **Defina prioridades** claras
3. **Revise planos** antes de executar
4. **Interprete resultados** no contexto

## üîó Integra√ß√£o com Frontend

### API Endpoints
```python
# Criar investiga√ß√£o
POST /api/v1/investigations
{
    "title": "An√°lise de Contratos 2024",
    "scope": {...},
    "priority": "high"
}

# Acompanhar progresso
GET /api/v1/investigations/{id}/progress

# Obter resultados
GET /api/v1/investigations/{id}/results
```

### WebSocket para Tempo Real
```javascript
// Conectar ao WebSocket
const ws = new WebSocket('ws://localhost:8000/ws/investigations/{id}');

ws.onmessage = (event) => {
    const update = JSON.parse(event.data);
    console.log(`Fase: ${update.phase}, Progresso: ${update.progress}%`);
};
```

---

**Pr√≥ximo:** [üîç Zumbi dos Palmares - Investigator Agent ‚Üí](./zumbi.md)