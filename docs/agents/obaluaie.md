---
title: "Obaluai√™ - Corruption Detector Agent"
sidebar_position: 12
description: "Agente especializado em detec√ß√£o avan√ßada de corrup√ß√£o sist√™mica"
---

# üè• Obaluai√™ - Corruption Detector Agent

:::warning **Status: üöß 15% Em Desenvolvimento**
Implementado em `src/agents/obaluaie.py` (236 linhas) com framework excelente mas algoritmos principais pendentes.
Documenta√ß√£o inline detalhada de algoritmos a implementar. Zero testes.
:::

## üìã Vis√£o Geral

O agente **Obaluai√™** √© o detector avan√ßado de corrup√ß√£o sist√™mica, especializado em identificar anomalias atrav√©s de an√°lise matem√°tica rigorosa, redes sociais e fluxos financeiros. Inspirado no orix√° da cura e transforma√ß√£o, este agente "cura" o sistema p√∫blico detectando e expondo a corrup√ß√£o.

### Identidade Cultural

Obaluai√™ (tamb√©m Omolu) √© o orix√° das doen√ßas e da cura na mitologia iorub√°. Representa a transforma√ß√£o atrav√©s da identifica√ß√£o e tratamento de males. Perfeito para um agente que identifica a "doen√ßa" da corrup√ß√£o para cur√°-la atrav√©s da transpar√™ncia.

## üéØ Capacidades Planejadas

### 1. **Lei de Benford para Detec√ß√£o de Manipula√ß√£o** üìä
```python
# F√≥rmula matem√°tica da Lei de Benford
P(d) = log‚ÇÅ‚ÇÄ(1 + 1/d) para d ‚àà {1,2,...,9}

# Threshold configur√°vel
benford_deviation_threshold = 0.15  # 15% de desvio m√°ximo
```
**Teoria**: N√∫meros naturais seguem uma distribui√ß√£o espec√≠fica nos primeiros d√≠gitos. Manipula√ß√£o causa desvios detect√°veis.

**Status**: ‚ö†Ô∏è Algoritmo documentado, implementa√ß√£o pendente

### 2. **Detec√ß√£o de Cart√©is em Licita√ß√µes** üè¢
```python
# T√©cnicas planejadas
- Social Network Analysis (SNA)
- Louvain Algorithm para detec√ß√£o de comunidades
- An√°lise de padr√µes de pre√ßos suspeitos
- Graph clustering para identificar grupos coordenados

# Threshold
cartel_probability_threshold = 0.70  # 70% de confian√ßa
```
**Detecta**:
- Empresas que sempre participam juntas
- Padr√µes de revezamento de vit√≥rias
- Pre√ßos artificialmente similares
- Coordena√ß√£o temporal suspeita

**Status**: üî¥ M√©todo stub, algoritmo n√£o implementado

### 3. **An√°lise de Fluxos Financeiros Suspeitos** üí∞
```python
# Algoritmos planejados
- Graph Neural Networks para transa√ß√µes
- An√°lise de Centralidade (Betweenness, Closeness)
- PageRank modificado para influ√™ncia corrupta
- Algoritmo de detec√ß√£o de lavagem de dinheiro

# Threshold
financial_anomaly_threshold = 0.80  # 80% de confian√ßa
```
**Detecta**:
- Structuring (smurfing)
- Shell companies
- Fluxos circulares
- Transa√ß√µes em camadas

**Status**: üî¥ M√©todo stub (`detect_money_laundering`)

### 4. **Detec√ß√£o de Nepotismo** üë®‚Äçüë©‚Äçüëß‚Äçüë¶
```python
# T√©cnicas planejadas
- An√°lise de grafos de relacionamentos
- Machine Learning para padr√µes familiares
- Coeficiente de Endogamia Pol√≠tica
- Cross-refer√™ncia com dados p√∫blicos (CNJ, TSE)

# Threshold
nepotism_score_threshold = 0.60  # 60% de confian√ßa
```
**Detecta**:
- Contrata√ß√µes entre parentes
- Favorecimento a conex√µes pol√≠ticas
- Redes de influ√™ncia familiar

**Status**: üî¥ M√©todo n√£o implementado

### 5. **√çndice de Transpar√™ncia** üîç
```python
# M√©tricas planejadas
- Scoring de Opacidade
- An√°lise de Entropia Informacional
- M√©tricas de Acessibilidade de Dados
- Transparency Corruption Index (TCI)

# Threshold
transparency_index_threshold = 0.40  # Abaixo de 40% = alerta
```
**Status**: üî¥ Algoritmo n√£o implementado

## üíª Implementa√ß√£o T√©cnica

### Estrutura da Classe
```python
class CorruptionDetectorAgent(BaseAgent):
    """
    Obaluai√™ - Detector de Corrup√ß√£o

    MISS√ÉO:
    Detecta anomalias sist√™micas indicativas de corrup√ß√£o atrav√©s de an√°lise
    avan√ßada de padr√µes, redes sociais e fluxos financeiros irregulares.
    """

    def __init__(self, config: Optional[Dict[str, Any]] = None):
        super().__init__(
            name="CorruptionDetectorAgent",
            description="Obaluai√™ - Detector avan√ßado de corrup√ß√£o sist√™mica"
        )

        # Configura√ß√µes de detec√ß√£o
        self.corruption_thresholds = {
            "benford_deviation": 0.15,      # Lei de Benford
            "cartel_probability": 0.70,     # Cart√©is
            "nepotism_score": 0.60,         # Nepotismo
            "transparency_index": 0.40,     # Transpar√™ncia
            "financial_anomaly": 0.80       # Anomalias financeiras
        }

        # Modelos de ML (a serem carregados)
        self.fraud_neural_network = None
        self.cartel_detector = None
        self.relationship_analyzer = None
```

### Exemplo de Uso (Planejado)
```python
from src.agents.obaluaie import CorruptionDetectorAgent, CorruptionSeverity
from src.agents.deodoro import AgentMessage, AgentContext

# Inicializar agente
obaluaie = CorruptionDetectorAgent()
await obaluaie.initialize()

# Preparar detec√ß√£o de corrup√ß√£o
message = AgentMessage(
    content={
        "action": "detect_corruption",
        "data": [
            {
                "contract_id": "CTR-2024-001",
                "value": 150000,
                "supplier": "Empresa X LTDA",
                "date": "2024-10-01",
                "bidding_participants": ["Empresa X", "Empresa Y", "Empresa Z"]
            },
            # ... mais contratos
        ]
    },
    sender="abaporu",
    context=AgentContext(
        investigation_id="INV-CORRUPTION-2024-001"
    )
)

# Executar detec√ß√£o
response = await obaluaie.process_message(message, context)

# Estrutura da resposta (planejada)
{
    "corruption_alert": {
        "alert_type": "systemic_corruption",
        "severity": "HIGH",  # LOW, MEDIUM, HIGH, CRITICAL
        "confidence_score": 0.85,
        "entities_involved": [
            "Empresa X LTDA",
            "Servidor P√∫blico Y",
            "Intermedi√°rio Z"
        ],
        "suspicious_patterns": [
            {
                "pattern": "price_manipulation",
                "score": 0.82,
                "evidence": "Benford's Law violation: chi-square = 15.8"
            },
            {
                "pattern": "bidding_cartel",
                "score": 0.78,
                "evidence": "Network analysis: 3 companies form tight cluster"
            },
            {
                "pattern": "nepotism",
                "score": 0.65,
                "evidence": "Relationship graph: 2nd degree connection detected"
            }
        ],
        "financial_impact": 1500000.0,  # R$ 1.5M estimado
        "evidence_links": [
            "Contract CTR-2024-001",
            "Network Graph node_45",
            "Transaction flow TRX-789"
        ],
        "risk_assessment": {
            "priority": "high",
            "urgency": "medium",
            "public_impact": "significant"
        },
        "timestamp": "2024-10-12T14:30:00Z",
        "investigation_priority": 9  # 1-10 scale
    },
    "status": "analysis_complete",
    "recommendations": [
        "Iniciar investiga√ß√£o formal imediata",
        "Notificar √≥rg√£os de controle competentes",
        "Suspender processos relacionados √†s entidades envolvidas",
        "Implementar monitoramento cont√≠nuo dos padr√µes detectados"
    ],
    "confidence": 0.85,
    "metadata": {
        "detection_type": "systematic",
        "model_version": "1.0",
        "algorithms_used": ["benford", "graph_analysis", "ml_classifier"]
    }
}
```

## üìä Algoritmos e T√©cnicas

### Lei de Benford (Planejado)
```python
async def _apply_benford_law(self, data: List[float]) -> float:
    """
    Aplica Lei de Benford para detectar manipula√ß√£o de dados

    Teoria: Primeiro d√≠gito de n√∫meros naturais segue:
    P(d=1) ‚âà 30.1%
    P(d=2) ‚âà 17.6%
    P(d=3) ‚âà 12.5%
    ...
    P(d=9) ‚âà 4.6%

    Retorna: Chi-square score de desvio
    """
    first_digits = [int(str(abs(x))[0]) for x in data if x > 0]
    observed_freq = np.bincount(first_digits, minlength=10)[1:] / len(first_digits)

    benford_expected = np.array([np.log10(1 + 1/d) for d in range(1, 10)])

    chi_square = np.sum((observed_freq - benford_expected)**2 / benford_expected)

    return chi_square  # > 15.507 = significativo (p<0.05)
```

### Detec√ß√£o de Cart√©is (Planejado)
```python
async def analyze_bidding_cartels(self, bidding_data: List[Dict]) -> Dict[str, Any]:
    """
    Detecta cart√©is usando an√°lise de grafos

    Algoritmo:
    1. Construir grafo de co-participa√ß√£o em licita√ß√µes
    2. Aplicar Louvain Algorithm para detectar comunidades
    3. Analisar padr√µes de pre√ßos dentro de comunidades
    4. Calcular m√©tricas de suspei√ß√£o:
       - Densidade de subgrafo
       - Modularidade
       - Coeficiente de clustering
    """
    # TODO: Implementar
    pass
```

### Detec√ß√£o de Lavagem de Dinheiro (Planejado)
```python
async def detect_money_laundering(self, financial_data: List[Dict]) -> Dict[str, Any]:
    """
    Detecta padr√µes de lavagem usando t√©cnicas de ML

    Padr√µes detectados:
    - Structuring: M√∫ltiplas transa√ß√µes abaixo do threshold de reporte
    - Layering: Transa√ß√µes em camadas para dificultar rastreamento
    - Integration: Reintrodu√ß√£o de dinheiro "limpo" na economia
    - Shell companies: Empresas de fachada
    - Round-tripping: Transa√ß√µes circulares
    """
    # TODO: Implementar
    pass
```

## üîß Estado de Implementa√ß√£o

### ‚úÖ O Que Funciona
1. **Framework Base**: Classe com estrutura completa
2. **Data Models**: `CorruptionAlertResult`, `CorruptionSeverity`
3. **Message Processing**: Pipeline de mensagens funcionando
4. **Logging & Audit**: Sistema de logs implementado
5. **Thresholds**: Configura√ß√µes de detec√ß√£o definidas
6. **Recommendations Generator**: L√≥gica de recomenda√ß√µes b√°sica

### ‚ö†Ô∏è O Que Est√° Planejado (Documentado mas n√£o implementado)
1. **Lei de Benford**: Algoritmo documentado, c√≥digo TODO
2. **Detec√ß√£o de Cart√©is**: M√©todo stub, precisa implementa√ß√£o
3. **Lavagem de Dinheiro**: M√©todo stub
4. **Nepotismo**: N√£o implementado
5. **√çndice de Transpar√™ncia**: N√£o implementado
6. **Modelos ML**: Vari√°veis definidas mas n√£o carregadas

### üî¥ Faltando Completamente
1. **Testes**: Zero cobertura
2. **Modelos ML Treinados**: Nenhum modelo pronto
3. **Integra√ß√£o com APIs Externas**: CNJ, TCU, COAF n√£o conectados
4. **Persist√™ncia**: Sem armazenamento de alertas
5. **Dashboard**: Sem visualiza√ß√£o de resultados

## üîÑ Integra√ß√£o no Sistema

```mermaid
graph LR
    A[Abaporu] -->|Corruption Analysis Request| O[Obaluai√™]
    O -->|Fetch Contracts| Portal[(Portal Transp.)]
    O -->|Check Legal Cases| CNJ[(CNJ)]
    O -->|Query Audits| TCU[(TCU)]
    O -->|Apply Algorithms| O
    O -->|High Risk Alert| T[Tiradentes]
    O -->|Pattern Storage| N[Nan√£]
    O -->|Legal Analysis| B[Bonif√°cio]

    style O fill:#FF9800
```

### Casos de Uso

#### Caso 1: Auditoria de Licita√ß√µes
```python
# Analisar processo licitat√≥rio suspeito
data = {
    "action": "detect_corruption",
    "scope": "bidding_process",
    "process_id": "LICIT-2024-0123",
    "analyze": ["benford", "cartel", "price_patterns"]
}
```

#### Caso 2: Investiga√ß√£o de Rede
```python
# Mapear rede de corrup√ß√£o
data = {
    "action": "detect_corruption",
    "scope": "network_analysis",
    "seed_entities": ["Empresa X", "Servidor Y"],
    "depth": 3  # At√© 3¬∫ grau de conex√£o
}
```

#### Caso 3: Monitoramento Cont√≠nuo
```python
# Alertas em tempo real
data = {
    "action": "detect_corruption",
    "scope": "continuous_monitoring",
    "watch_list": ["√≥rg√£o_123", "empresa_xyz"],
    "frequency": "daily"
}
```

## üìö Base Te√≥rica e Refer√™ncias

### Lei de Benford
- **Paper Original**: Benford, F. (1938). "The Law of Anomalous Numbers"
- **Aplica√ß√£o**: Detec√ß√£o de fraude fiscal, eleitoral, cont√°bil
- **Casos de Uso**: IRS (USA), Controladoria Geral da Uni√£o (BR)

### Algoritmos de Grafos
- **Louvain Algorithm**: Blondel et al. (2008)
- **PageRank**: Brin & Page (1998)
- **Community Detection**: Newman (2006)

### Machine Learning para Fraude
- **Isolation Forest**: Liu et al. (2008)
- **Autoencoders**: Hinton & Salakhutdinov (2006)
- **Graph Neural Networks**: Kipf & Welling (2017)

### Legisla√ß√£o Brasileira
- **Lei 8.429/1992**: Lei de Improbidade Administrativa
- **Lei 12.846/2013**: Lei Anticorrup√ß√£o (responsabilidade empresas)
- **Lei 9.613/1998**: Lei de Lavagem de Dinheiro (alterada por Lei 12.683/2012)

## üöÄ Roadmap de Implementa√ß√£o

### Fase 1: Algoritmos B√°sicos (2-3 semanas)
```python
# Prioridade alta
- [ ] Implementar Lei de Benford completa
- [ ] Criar detec√ß√£o b√°sica de cart√©is (grafo simples)
- [ ] Implementar c√°lculo de risco de corrup√ß√£o
- [ ] Adicionar testes unit√°rios (60% coverage)
```

### Fase 2: Machine Learning (4-6 semanas)
```python
# Treinar modelos
- [ ] Fraud Neural Network (LSTM)
- [ ] Cartel Detector (Graph CNN)
- [ ] Anomaly Detection (Isolation Forest)
- [ ] Valida√ß√£o com dados hist√≥ricos
```

### Fase 3: Integra√ß√µes (3-4 semanas)
```python
# Conectar APIs externas
- [ ] CNJ API (processos judiciais)
- [ ] TCU API (auditorias)
- [ ] COAF (opera√ß√µes financeiras - se dispon√≠vel)
- [ ] Portal da Transpar√™ncia (contratos)
```

### Fase 4: Produ√ß√£o (2 semanas)
```python
# Preparar para produ√ß√£o
- [ ] Performance testing
- [ ] Security audit
- [ ] Dashboard de alertas
- [ ] Documenta√ß√£o completa
```

## üêõ Limita√ß√µes Conhecidas

1. **Sem Algoritmos Implementados**
   - M√©todos principais s√£o stubs
   - **Solu√ß√£o**: Implementar algoritmos conforme roadmap

2. **Sem Modelos ML**
   - Vari√°veis definidas mas modelos n√£o treinados
   - **Solu√ß√£o**: Treinar com datasets p√∫blicos

3. **Sem Testes**
   - Zero cobertura de testes
   - **Solu√ß√£o**: Criar suite completa (TDD)

4. **APIs Externas N√£o Integradas**
   - CNJ, TCU, COAF n√£o conectados
   - **Solu√ß√£o**: Implementar clientes de API

## üìä M√©tricas de Performance (Planejadas)

| M√©trica | Meta | Status |
|---------|------|--------|
| **Precis√£o** | >92% | üî¥ N/A |
| **Recall** | >88% | üî¥ N/A |
| **F1-Score** | >0.90 | üî¥ N/A |
| **Falsos Positivos** | <5% | üî¥ N/A |
| **Tempo de An√°lise** | <5s para 1k contratos | üî¥ N/A |

## üìû Pr√≥ximas A√ß√µes Imediatas

### üî• Urgente (Esta Semana)
1. **Implementar Lei de Benford** - Algoritmo matem√°tico puro
2. **Criar testes unit√°rios** para estruturas existentes
3. **Documentar casos de teste** espec√≠ficos brasileiros

### üìà Curto Prazo (2 Semanas)
4. **Implementar detec√ß√£o b√°sica de cart√©is** (grafo simples)
5. **Conectar Portal da Transpar√™ncia** para dados reais
6. **Validar Lei de Benford** com dados hist√≥ricos

---

**Documenta√ß√£o Relacionada**:
- [Vis√£o Geral dos Agentes](./overview.md)
- [Ox√≥ssi - Fraud Hunter](./oxossi.md)
- [Zumbi - Anomaly Detective](./zumbi.md)

---

**Nota**: Documenta√ß√£o excelente no c√≥digo-fonte com detalhamento de todos os algoritmos planejados. Framework s√≥lido esperando implementa√ß√£o dos algoritmos matem√°ticos e de ML. Lei de Benford √© prioridade para implementa√ß√£o! üè•
